#####################
# Run Control file # 
#####################
# Steps to be run 
algorithm_list:
  # - grid_for_elev_change_regrid
  # - grid_for_elev_change_update_year 
  # - surface_fit 
  - epoch_average
  - interpolate_grids_of_dh
  - single_mission_dhdt

# Algorithm configurations
grid_for_elev_change_regrid:
  base_dir: "/home/willisc3/luna/CPOM/archive/SATS/RA/CRY/L2/CRYO-TEMPO/BASELINE-C/LAND_ICE/GREENL"
  dataset: "/home/willisc3/luna/CPOM/willisc3/cpom_software2/src/cpom/altimetry/datasets/definitions/cryotempo.yml"
  griddir: "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/gridded_altimetry/"
  area: 'greenland_is'
  gridarea: "greenland"
  binsize: 5000
  standard_epoch: "1991-01-01T00:00:00"
  partition_xy_chunking: 200  # Number of grid cells in each partition - The larger the quicker surface fit
  # Reduce if facing issues with memory

grid_for_elev_change_update_year:
  update_year: 2017
  griddir : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/gridded_altimetry/larger_partitions/cs2/greenland_5km_cs2"
  grid_metadata: "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/gridded_altimetry/larger_partitions/cs2/greenland_5km_cs2/grid_meta.json"

surface_fit:
  griddir: "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/gridded_altimetry/cs2/greenland_5km_cs2/"
  sf_dir: "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/surface_fit/"
  min_vals_in_cell: 20
  min_percent_timespan_in_cell: 70.0
  n_sigma: 2.0
  max_surfacefit_iterations: 30
  max_linearfit_iterations: 3
  mintime: "2010/01/20"
  maxtime : "2024/07/31"
  powercorrect : False 
  pcmintime : "2010/01/20"
  pcmaxtime : "2024/07/31"
  weighted_surface_fit : False

epoch_average:
  sfdir :  "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/surface_fit/linlag/cs2/greenland_5km_cs2/"
  epochdir : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/epoch_average/"

interpolate_grids_of_dh: 
  indir : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/epoch_average/cs2/greenland_5km_cs2/"
  gridmeta_file : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/gridded_altimetry/cs2/greenland_5km_cs2/grid_meta.json"
  outdir : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/interpolated_grids/"
  grouping_column : "epoch_number"
  variables_in : ["dh_ave", "dh_stddev"]
  variables_out : ["dh_ave", "dh_stddev"]

single_mission_dhdt: 
  indir : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/interpolated_grids/cs2/greenland_5km_cs2/"
  outdir: "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/dhdt/"
  gridmeta_file : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/gridded_altimetry/cs2/greenland_5km_cs2/grid_meta.json"
  # dhdt_start: None
  # dhdt_end: None
  # dhdt_period: "1y"
  # step_length: "6m"
  min_pts_in_period: 30
  min_period_coverage : 50 
  max_allowed_dhdt : 30 
  dh_avg_varname: "dh_ave"
  dh_stddev_varname: "dh_stddev"
  dh_time_varname: "epoch_midpoint_dt"
  dh_time_fractional_varname: "epoch_midpoint_fractional_yr"
