#################################################
# Single Mission Run Control File for Greenland # 
#################################################

# This file processes one mission at a time
# Mission-specific parameters are defined in the missions section
# Use: python run_chain.py --config greenland_single_mission.yml --mission <mission_name>

# Steps to be run for single mission processing
missions_to_run: 
  # - e1
  # - e2
  # - env
  - cs2

base_out : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/antarctica"

e1:
  algorithm_list : 
    # - grid_for_elev_change
    # - surface_fit
    # - surface_fit_plots
    # - epoch_average
    - clip_to_basins
    # - calculate_dhdt

  base_folder: "e1_5km"
  grid_for_elev_change:
    data_input_dir: "/home/willisc3/luna/CPOM/archive/SATS/RA/ERS1/L2/FDR4ALT/TDP/antarctica/land_ice"
    dataset: "/home/willisc3/luna/CPOM/willisc3/cpom_software2/src/cpom/altimetry/datasets/definitions/e1_fdr4alt.yml"
    fill_missing_poca: true  
  epoch_average: 
      epoch_start: "21/05/1991"
      epoch_end: "01/10/1996"
      # epoch_filter_threshold: 0.80

e2:
  algorithm_list : 
    # - grid_for_elev_change
    # - surface_fit
    # - epoch_average
    - clip_to_basins
    # - calculate_dhdt
  base_folder: "e2_5km"
  grid_for_elev_change:
    data_input_dir: "/home/willisc3/luna/CPOM/archive/SATS/RA/ERS2/L2/FDR4ALT/TDP/antarctica/land_ice"
    dataset: "/home/willisc3/luna/CPOM/willisc3/cpom_software2/src/cpom/altimetry/datasets/definitions/e2_fdr4alt.yml"
    fill_missing_poca: true
  epoch_average: 
      epoch_start: "21/03/1995"
      epoch_end: "26/08/2003"

env:
  algorithm_list : 
    # - grid_for_elev_change
    # - surface_fit
    # - epoch_average
    - clip_to_basins
    # - calculate_dhdt
  base_folder: "env_5km"
  grid_for_elev_change:
    data_input_dir: "/home/willisc3/luna/CPOM/archive/SATS/RA/ENV/L2/FDR4ALT/TDP/antarctica/land_ice"
    dataset: "/home/willisc3/luna/CPOM/willisc3/cpom_software2/src/cpom/altimetry/datasets/definitions/env_fdr4alt.yml"
    fill_missing_poca: true
  surface_fit: 
    pcmintime: "01/01/2005"
    pcmaxtime: "01/01/2020"
  epoch_average: 
      epoch_start: "01/07/2002"
      epoch_end: "19/06/2012"


cs2:
  algorithm_list : 
    - grid_for_elev_change
    - surface_fit
    - epoch_average
    - clip_to_basins
    # - calculate_dhdt
  base_folder: "cs2_5km"
  grid_for_elev_change:
    data_input_dir: "/home/willisc3/luna/CPOM/archive/SATS/RA/CRY/L2/CRYO-TEMPO/BASELINE-D/LAND_ICE/ANTARC"
    dataset: "/home/willisc3/luna/CPOM/willisc3/cpom_software2/src/cpom/altimetry/datasets/definitions/cryotempo.yml"
  surface_fit:
    mintime: "20/10/2010"
    maxtime: "28/02/2025"
    pcmintime: "20/10/2010"
    pcmaxtime: "01/03/2025"
    mode_values: [1, 3]  # LRM and SIN

#-----------------------------------------------------------#
# Common processing parameters (shared across all missions) #
#-----------------------------------------------------------#

########################
# SEC Processing Steps # 
########################

grid_for_elev_change:
  out_folder_name: gridded_altimetry
  area: 'antarctica'
  gridarea: "antarctica"
  binsize: 5000
  standard_epoch: "1991-01-01T00:00:00"
  partition_xy_chunking: 100  # Number of grid cells in each partition
  # Mission-specific parameters (data_input_dir, dataset) will be merged from missions section

surface_fit:  
  in_step: "grid_for_elev_change"
  out_folder_name: surface_fit
  min_vals_in_cell: 20
  min_percent_timespan_in_cell: 70.0
  n_sigma: 2.0
  max_surfacefit_iterations: 30
  max_linearfit_iterations: 3
  weighted_surface_fit: false
  powercorrect : true
  # Mission-specific parameters (mintime, maxtime, etc.) will be merged from missions section

surface_fit_plots:
  in_step: "surface_fit"
  out_folder_name: surface_fit_plots
  
epoch_average:
  in_step: "surface_fit"
  out_folder_name: epoch_average
  epoch_length: 140
  gia_model: "ij05"

clip_to_basins:
  in_step: "epoch_average"
  out_folder_name: epoch_average_basins
  shapefile: ant_basins_imbie2
  region_selector: ['all']
  subregion_selector: ['all']

calculate_dhdt: 
  in_step: "epoch_average"
  out_folder_name: single_mission_dhdt
  min_pts_in_period: 10
  min_period_coverage: 50 
  max_allowed_dhdt: 30 
  dh_avg_varname: "dh_ave"
  dh_stddev_varname: "dh_stddev"
  dh_time_varname: "epoch_midpoint_dt"
  dh_time_fractional_varname: "epoch_midpoint_fractional_yr"
  parquet_glob: "*/epoch_average.parquet"