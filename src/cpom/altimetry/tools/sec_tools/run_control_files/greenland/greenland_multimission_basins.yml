#####################
# Multi-Mission Run Control File for Greenland # 
#####################
# Steps to be run for multi-mission processing
algorithm_list:
  # - cross_calibrate_missions
  # - calculate_dhdt
  - dhdt_plots

########################
# Multi-Mission Processing Steps # 
########################
base_out : "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/v2/"

cross_calibrate_missions:
  out_folder_name: "cross_calibrated"
  mission_mapper: { 
    "e1": "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/v2/greenland_e1_5km/epoch_average_glaciers/",
    "e2": "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/v2/greenland_e2_5km/epoch_average_glaciers/",
    "env": "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/v2/greenland_env_5km/epoch_average_glaciers/",
    "cs2": "/home/willisc3/luna/CPOM/willisc3/EOCIS/altimetry/landice/v2/greenland_cs2_5km/epoch_average_glaciers/",
  }
  missions_sorted: ["e1", "e2", "env", "cs2"]
  bias_threshold: 100  # meters (matches old cross-calibration code)
  epoch_column: "epoch_number"
  time_column: "epoch_hi_dt"
  dh_column: "dh_ave"
  sub_basins: ['PETERMANN_GLETSCHER', 'HELHEIMGLETSCHER', 'JAKOBSHAVN_ISBRAE',
        'KANGERLUSSUAQ', 'ZACHARIAE_ISSTROM', 'NIOGHALVFJERDSFJORDEN']
  min_observations: 5 

calculate_dhdt:
  in_step: "cross_calibrate_missions"
  out_folder_name: cross_calibrated_dhdt
  min_pts_in_period: 10
  min_period_coverage: 50 
  max_allowed_dhdt: 30 
  dh_avg_varname: "biased_dh"
  dh_stddev_varname: "dh_stddev"
  dh_time_varname: "epoch_midpoint_dt"
  dh_time_fractional_varname: "epoch_midpoint_fractional_yr"
  xcal_stderr_varname : "stderr"
  parquet_glob: "*corrected_epoch_average.parquet"
  step_length: 1y
  dhdt_period: 5y
  sub_basins: ['PETERMANN_GLETSCHER', 'HELHEIMGLETSCHER', 'JAKOBSHAVN_ISBRAE',
        'KANGERLUSSUAQ', 'ZACHARIAE_ISSTROM', 'NIOGHALVFJERDSFJORDEN']

dhdt_plots: 
  in_step: calculate_dhdt
  out_folder_name: cross_calibrated_dhdt
  plot_range: [-1, 1]
  sub_basins: ['PETERMANN_GLETSCHER', 'HELHEIMGLETSCHER', 'JAKOBSHAVN_ISBRAE',
        'KANGERLUSSUAQ', 'ZACHARIAE_ISSTROM', 'NIOGHALVFJERDSFJORDEN']
  area_name : 'greenland'
  grid_area : 'greenland'
  binsize : 5000 
